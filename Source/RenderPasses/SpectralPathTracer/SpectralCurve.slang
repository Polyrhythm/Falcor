
// 360nm to 830nm
// http://scottburns.us/fast-rgb-to-spectrum-conversion-for-reflectances/
// http://scottburns.us/wp-content/uploads/2020/01/RGB-Components-CIE-1931-1nm.csv

#define CIE_LAMBDA_MIN 360.0
#define CIE_LAMBDA_MAX 830.0
#define CIE_SAMPLES    95

static const double cie_x[CIE_SAMPLES] = {
    0.000129900000, 0.000232100000, 0.000414900000, 0.000741600000,
    0.001368000000, 0.002236000000, 0.004243000000, 0.007650000000,
    0.014310000000, 0.023190000000, 0.043510000000, 0.077630000000,
    0.134380000000, 0.214770000000, 0.283900000000, 0.328500000000,
    0.348280000000, 0.348060000000, 0.336200000000, 0.318700000000,
    0.290800000000, 0.251100000000, 0.195360000000, 0.142100000000,
    0.095640000000, 0.057950010000, 0.032010000000, 0.014700000000,
    0.004900000000, 0.002400000000, 0.009300000000, 0.029100000000,
    0.063270000000, 0.109600000000, 0.165500000000, 0.225749900000,
    0.290400000000, 0.359700000000, 0.433449900000, 0.512050100000,
    0.594500000000, 0.678400000000, 0.762100000000, 0.842500000000,
    0.916300000000, 0.978600000000, 1.026300000000, 1.056700000000,
    1.062200000000, 1.045600000000, 1.002600000000, 0.938400000000,
    0.854449900000, 0.751400000000, 0.642400000000, 0.541900000000,
    0.447900000000, 0.360800000000, 0.283500000000, 0.218700000000,
    0.164900000000, 0.121200000000, 0.087400000000, 0.063600000000,
    0.046770000000, 0.032900000000, 0.022700000000, 0.015840000000,
    0.011359160000, 0.008110916000, 0.005790346000, 0.004109457000,
    0.002899327000, 0.002049190000, 0.001439971000, 0.000999949300,
    0.000690078600, 0.000476021300, 0.000332301100, 0.000234826100,
    0.000166150500, 0.000117413000, 0.000083075270, 0.000058706520,
    0.000041509940, 0.000029353260, 0.000020673830, 0.000014559770,
    0.000010253980, 0.000007221456, 0.000005085868, 0.000003581652,
    0.000002522525, 0.000001776509, 0.000001251141
};

static const double cie_y[CIE_SAMPLES] = {
    0.000003917000, 0.000006965000, 0.000012390000, 0.000022020000,
    0.000039000000, 0.000064000000, 0.000120000000, 0.000217000000,
    0.000396000000, 0.000640000000, 0.001210000000, 0.002180000000,
    0.004000000000, 0.007300000000, 0.011600000000, 0.016840000000,
    0.023000000000, 0.029800000000, 0.038000000000, 0.048000000000,
    0.060000000000, 0.073900000000, 0.090980000000, 0.112600000000,
    0.139020000000, 0.169300000000, 0.208020000000, 0.258600000000,
    0.323000000000, 0.407300000000, 0.503000000000, 0.608200000000,
    0.710000000000, 0.793200000000, 0.862000000000, 0.914850100000,
    0.954000000000, 0.980300000000, 0.994950100000, 1.000000000000,
    0.995000000000, 0.978600000000, 0.952000000000, 0.915400000000,
    0.870000000000, 0.816300000000, 0.757000000000, 0.694900000000,
    0.631000000000, 0.566800000000, 0.503000000000, 0.441200000000,
    0.381000000000, 0.321000000000, 0.265000000000, 0.217000000000,
    0.175000000000, 0.138200000000, 0.107000000000, 0.081600000000,
    0.061000000000, 0.044580000000, 0.032000000000, 0.023200000000,
    0.017000000000, 0.011920000000, 0.008210000000, 0.005723000000,
    0.004102000000, 0.002929000000, 0.002091000000, 0.001484000000,
    0.001047000000, 0.000740000000, 0.000520000000, 0.000361100000,
    0.000249200000, 0.000171900000, 0.000120000000, 0.000084800000,
    0.000060000000, 0.000042400000, 0.000030000000, 0.000021200000,
    0.000014990000, 0.000010600000, 0.000007465700, 0.000005257800,
    0.000003702900, 0.000002607800, 0.000001836600, 0.000001293400,
    0.000000910930, 0.000000641530, 0.000000451810
};

static const double cie_z[CIE_SAMPLES] = {
    0.000606100000, 0.001086000000, 0.001946000000, 0.003486000000,
    0.006450001000, 0.010549990000, 0.020050010000, 0.036210000000,
    0.067850010000, 0.110200000000, 0.207400000000, 0.371300000000,
    0.645600000000, 1.039050100000, 1.385600000000, 1.622960000000,
    1.747060000000, 1.782600000000, 1.772110000000, 1.744100000000,
    1.669200000000, 1.528100000000, 1.287640000000, 1.041900000000,
    0.812950100000, 0.616200000000, 0.465180000000, 0.353300000000,
    0.272000000000, 0.212300000000, 0.158200000000, 0.111700000000,
    0.078249990000, 0.057250010000, 0.042160000000, 0.029840000000,
    0.020300000000, 0.013400000000, 0.008749999000, 0.005749999000,
    0.003900000000, 0.002749999000, 0.002100000000, 0.001800000000,
    0.001650001000, 0.001400000000, 0.001100000000, 0.001000000000,
    0.000800000000, 0.000600000000, 0.000340000000, 0.000240000000,
    0.000190000000, 0.000100000000, 0.000049999990, 0.000030000000,
    0.000020000000, 0.000010000000, 0.000000000000, 0.000000000000,
    0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
    0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
    0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
    0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
    0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
    0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
    0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
    0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
    0.000000000000, 0.000000000000, 0.000000000000
};

// 390nm - 780nm
// https://graphics.geometrian.com/research/spectral-primaries.html
static const float3 cie2006_basis[] = {
    float3(0.361396471056708,0.252275705864828,0.386327749991032),
    float3(0.366205305492837,0.235416148479571,0.398378488359465),
    float3(0.371266544491276,0.21551362909132,0.413219780889496),
    float3(0.375826682752906,0.193361838306436,0.430811443451517),
    float3(0.378931281646137,0.170213950722939,0.450854739893322),
    float3(0.379486367262762,0.146935008502323,0.473578602657459),
    float3(0.376593730760743,0.124520895668156,0.498885356527868),
    float3(0.369558349313344,0.104513543161356,0.525928094462577),
    float3(0.358873584245906,0.0873768593817381,0.553749546116267),
    float3(0.345130566986974,0.072963535226373,0.581905889627497),
    float3(0.328251563088163,0.0610398371212503,0.610708593091079),
    float3(0.308552505415631,0.0513190921255156,0.640128397106951),
    float3(0.287174624808842,0.0433949906128264,0.669430380270105),
    float3(0.265201641787191,0.0368826097572261,0.6979157450652),
    float3(0.243045727135127,0.0314748187061981,0.725479451241526),
    float3(0.220937878555078,0.0269368109732676,0.752125308174961),
    float3(0.199346669367302,0.023102088919068,0.777551239751982),
    float3(0.178921019256518,0.0198804141079897,0.801198565198056),
    float3(0.160082581682908,0.0171951627504054,0.822722254635495),
    float3(0.143043624509629,0.0149725918056479,0.8419837825555),
    float3(0.127647149539569,0.0131454383663785,0.859207411299804),
    float3(0.114788573984292,0.0116487280786844,0.873562697296838),
    float3(0.103316260235184,0.0104086932344483,0.886275046348654),
    float3(0.0932518666479813,0.00936480867269029,0.897383323885414),
    float3(0.0843664327916331,0.00847145272002132,0.907162114032132),
    float3(0.0764577020390705,0.00769379991480418,0.915848497678197),
    float3(0.0693845001234432,0.00700864335902012,0.923606856599652),
    float3(0.0631104736138383,0.00641054210726977,0.930478984200588),
    float3(0.0576046106519274,0.00589653172568395,0.936498857804),
    float3(0.0528265500146353,0.00546274898698706,0.941710700798877),
    float3(0.0487277455283648,0.00510516507487266,0.946167089538723),
    float3(0.0452464572772848,0.00481770982409582,0.949935832819348),
    float3(0.0422725820425418,0.00458608307901361,0.953141334919228),
    float3(0.039703262373669,0.00439668646497515,0.955900051146983),
    float3(0.037455139058216,0.0042384011939596,0.95830645982211),
    float3(0.0354600372812668,0.00410184676768847,0.960438115944202),
    float3(0.0336564467190598,0.00397915803696281,0.962364395327574),
    float3(0.0319714709061577,0.00386435524834813,0.964164173954034),
    float3(0.0303366881445415,0.00375206176074797,0.965911250170638),
    float3(0.0286933099515374,0.00363728832521505,0.967669401788626),
    float3(0.0269947205432021,0.00351577644591095,0.969489502991052),
    float3(0.0252282217111559,0.00338580522402117,0.971385973151492),
    float3(0.0234580083647742,0.00325171858372909,0.973290273119263),
    float3(0.0217527228115435,0.00311853091617314,0.975128746288891),
    float3(0.0201631925905153,0.00299005839993127,0.976846749143154),
    float3(0.0187234576407893,0.00286884779294434,0.978407694612511),
    float3(0.0174488994506994,0.00275663952405543,0.979794461148403),
    float3(0.0163280904902336,0.00265565645819332,0.981016253259442),
    float3(0.0153452468886244,0.00256813127759055,0.982086621981104),
    float3(0.0144861780559633,0.00249614943952171,0.983017672674219),
    float3(0.0137381956551172,0.00244178408164589,0.983820020431351),
    float3(0.0130867474600425,0.00240592043900152,0.984507332309904),
    float3(0.0125066008328427,0.00238445312895018,0.985108946336329),
    float3(0.011974039235965,0.00237241835583257,0.985653542707892),
    float3(0.0114695448056021,0.00236512543691745,0.986165330037658),
    float3(0.0109771084042056,0.00235800437504581,0.986664887523997),
    float3(0.0104892403205561,0.00234831284715694,0.987162447120292),
    float3(0.0100203951870777,0.00234037259593541,0.9876392324978),
    float3(0.00958680322480087,0.00234017145989162,0.988073025622264),
    float3(0.00920042585973419,0.00235367021686863,0.98844590421961),
    float3(0.00887973072081534,0.00238786516006445,0.988732404442236),
    float3(0.00860520827065324,0.00244643706709479,0.988948354934752),
    float3(0.00836732063173359,0.00252780336726841,0.989104876266163),
    float3(0.00817777671420739,0.00263166056927542,0.98919056298573),
    float3(0.00797728196919423,0.00275031422799895,0.989272404046558),
    float3(0.00776280756773801,0.00288050327073746,0.98935668943516),
    float3(0.00752322480656702,0.00301827558713578,0.989458499794256),
    float3(0.00738176284055312,0.00320753131923758,0.989410706072419),
    float3(0.00717964596439533,0.00336752685268753,0.989452827341526),
    float3(0.00696721407329869,0.00356965698692528,0.989463129090929),
    float3(0.00716956338982263,0.00393592724088271,0.988894509503006),
    float3(0.00648723991847956,0.00404960604105882,0.989463154193344),
    float3(0.00621620145572442,0.00432111336519908,0.989462685306371),
    float3(0.0061703417349609,0.00479375415814202,0.989035904178019),
    float3(0.00563348899865069,0.00495835307356082,0.989408158002329),
    float3(0.00523483096796861,0.00531690945791252,0.989448259605118),
    float3(0.00498377479547626,0.0058246166160886,0.989191608599878),
    float3(0.004760911210281,0.00647607419329812,0.98876301457901),
    float3(0.00454208151498636,0.00727757698303369,0.988180341484035),
    float3(0.00432748461853859,0.00827234652401926,0.987400168773758),
    float3(0.00411781951832206,0.00952326464963346,0.986358915732748),
    float3(0.00391410266312994,0.01112695996682,0.984958937279945),
    float3(0.00371757718278664,0.0132432651492109,0.983039157613706),
    float3(0.00352930218980754,0.0161528616582408,0.980317836116817),
    float3(0.00334999643313325,0.0203955708927266,0.976254432608402),
    float3(0.00317999229993085,0.0271578607388973,0.969662146952061),
    float3(0.00301966868590795,0.0396332002480259,0.957347131162118),
    float3(0.0028705041211961,0.070325853543585,0.926803642017144),
    float3(0.00273363515083904,0.24992097853778,0.747345386062212),
    float3(0.00260950322849179,0.879787924982616,0.117602571707971),
    float3(0.00249856306030856,0.942808059071281,0.0546933780587161),
    float3(0.00240066290421108,0.961783902277145,0.0358154347561766),
    float3(0.00231441511884631,0.970867923905408,0.0268176608120465),
    float3(0.002238381861103,0.976185165981655,0.0215764518969246),
    float3(0.00217134831811772,0.979669430483185,0.0181592209856099),
    float3(0.00211227274835322,0.982122997849185,0.0157647290494959),
    float3(0.0020599209693597,0.983940230816847,0.0139998478832392),
    float3(0.00201189235285397,0.985344314099166,0.0126437931961052),
    float3(0.00196564633691464,0.986472843092402,0.0115615102294631),
    float3(0.0019188261125259,0.987415571260503,0.0106656022184081),
    float3(0.00186926818990606,0.988233933976807,0.00989679742413786),
    float3(0.00181574188025131,0.988967351292169,0.00921690639569143),
    float3(0.00175994912822348,0.989628436356831,0.00861161406580099),
    float3(0.00170413548536508,0.99022167636531,0.00807418769585527),
    float3(0.00165032161433526,0.990749529062014,0.00760014882948853),
    float3(0.00160029995498627,0.991213264076789,0.00718643549381231),
    float3(0.00155523718724574,0.9916158354081,0.00682892692078097),
    float3(0.00151452891335767,0.991968465695081,0.00651700491485177),
    float3(0.00147724647237568,0.992282013932627,0.0062407391000766),
    float3(0.00144256240580218,0.992565087190795,0.00599234991916047),
    float3(0.00140973348628126,0.992824627795095,0.00576563823354133),
    float3(0.00137819444959272,0.993065715524064,0.00555608953555029),
    float3(0.00134785214360529,0.993290265822737,0.0053618815464683),
    float3(0.00131872380811099,0.993499408376993,0.00518186733421665),
    float3(0.00129082419404661,0.993694174648865,0.0050150006772275),
    float3(0.00126416553960866,0.993875508465271,0.00486032552149924),
    float3(0.00123879678964318,0.994043994807604,0.00471720794432022),
    float3(0.00121490507172813,0.994199227128935,0.00458586734744344),
    float3(0.00119268748968416,0.99434082146648,0.00446649061921878),
    float3(0.00117231872567021,0.9944685990092,0.00435908185244806),
    float3(0.00115395914029295,0.99458250229289,0.00426353773101575),
    float3(0.00113765908123584,0.994682942820404,0.00417939769621543),
    float3(0.00112308682297844,0.994772367251123,0.00410454554247749),
    float3(0.00110983780104095,0.994853284357552,0.00403687747816938),
    float3(0.00109753225709246,0.994927910792738,0.00397455660214574),
    float3(0.0010858089015939,0.994998227701555,0.00391596305004663),
    float3(0.00107438975803964,0.995065715237115,0.00385989467364532),
    float3(0.00106327904468655,0.99513049133726,0.00380622930570586),
    float3(0.00105254847301566,0.995192376992653,0.00375507423229327),
    float3(0.00104226962376743,0.995251212297542,0.00370651779073142),
    float3(0.00103251630213132,0.995306839002218,0.00366064442174718),
    float3(0.00102336575919332,0.99535908122064,0.00361755276006225),
    float3(0.0010148875099738,0.995407755600887,0.00357735664476775),
    float3(0.00100714743087891,0.995452664088211,0.00354018824601941),
    float3(0.00100020772645907,0.995493605880918,0.00350618616349645),
    float3(0.000994125554320192,0.995530387771965,0.00347548646268983),
    float3(0.000989926960592362,0.99554321506467,0.0034668577747009),
    float3(0.000991948494702743,0.995497510348077,0.00351054096262953),
    float3(0.00098671008139981,0.995531526937004,0.00348176278783334),
    float3(0.000987616131106955,0.99554321497737,0.00346916872609295),
    float3(0.000990739109245901,0.995520046419803,0.00348921429895365),
    float3(0.00100095814751352,0.995423737690503,0.00357530400801253),
    float3(0.000997854413296231,0.995513566484496,0.00348857893771747),
    float3(0.00100025563925044,0.995543214534084,0.00345652968956841),
    float3(0.00100582960564373,0.995537358480228,0.00345681178555054),
    float3(0.00101103444907204,0.995543214885874,0.00344575053416357),
    float3(0.00101836470571876,0.995520638106343,0.00346099706992487),
    float3(0.00102583697481177,0.995497471616308,0.00347669129489027),
    float3(0.00103360186414059,0.995473442631189,0.00349295540560879),
    float3(0.0010418518712566,0.995447704444406,0.00351044358909034),
    float3(0.00105077832995165,0.995419417709551,0.00352980387571236),
    float3(0.00106057016705192,0.995387766205211,0.00355166354883467),
    float3(0.00107140538599571,0.995352029022475,0.0035765655161336),
    float3(0.00108346861367711,0.995311476680984,0.00360505463528331),
    float3(0.00109695575857428,0.995265341928867,0.00363770225523469),
    float3(0.00111207603877874,0.995212813053082,0.00367511085173541),
    float3(0.00112899571787142,0.995153277871117,0.00371772635416002),
    float3(0.00114766180235258,0.995087080512621,0.00376525764227259),
    float3(0.00116797249435672,0.995014784310207,0.0038172431573299),
    float3(0.0011898337199143,0.994936929361246,0.00387323688317441),
    float3(0.00121316308520745,0.994854019433739,0.00393281745719606),
    float3(0.00123798089476159,0.994766155185609,0.00399586391102516),
    float3(0.00126468492671321,0.994672035539955,0.00406327952871428),
    float3(0.00129386318953173,0.994569245303462,0.0041368915146827),
    float3(0.00132607312406012,0.99445616654204,0.00421776035325079),
    float3(0.00136199274322546,0.994330383860827,0.00430762342964648),
    float3(0.00140218827558767,0.994190097607497,0.00440771416843773),
    float3(0.00144657027980234,0.994036044265193,0.00451738551819895),
    float3(0.0014948414463994,0.993869748034934,0.00463541058975732),
    float3(0.00154664697157499,0.993692933166304,0.00476041994827885),
    float3(0.00160155611031673,0.99350757585286,0.00489086813480547),
    float3(0.00165934351590016,0.99331488522358,0.0050257713662265),
    float3(0.00172098970224122,0.993111819487787,0.00516719092074947),
    float3(0.00178799311734439,0.992893717152543,0.00531828984558922),
    float3(0.00186215733594893,0.992655160595531,0.0054826822156781),
    float3(0.00194567722982058,0.992389796604603,0.00566452632394037),
    float3(0.00204086187457851,0.992091428392607,0.00586770989006352),
    float3(0.00214886544504434,0.991758320093876,0.00609281463710752),
    float3(0.00227060126556373,0.991389991655376,0.00633940725496502),
    float3(0.00240710194018797,0.990986049346417,0.00660684890039683),
    float3(0.00255951308567156,0.990546281797964,0.00689420534461247),
    float3(0.00272961003173243,0.990069109916685,0.00720128027028609),
    float3(0.00292172449778344,0.98954595110701,0.00753232463362984),
    float3(0.00314209112563573,0.988964336016287,0.00789357309271495),
    float3(0.00339901430740703,0.988308532045919,0.00829245388040288),
    float3(0.0037036775131452,0.987559367177946,0.00873695559222785),
    float3(0.00407200203530361,0.986688050028538,0.00923994823615614),
    float3(0.00452541495588699,0.985665328561487,0.00980925675224465),
    float3(0.00509650009960986,0.984445619212887,0.0104578809719572),
    float3(0.00583624568025899,0.982963667419555,0.0112000872332953),
    float3(0.00682876239517714,0.981120811222337,0.0120504266988633),
    float3(0.00822405389000236,0.978747717078863,0.0130282292907272),
    float3(0.0102850220872316,0.975586251520629,0.0141287269296979),
    float3(0.013574328845884,0.971070041435139,0.0153556301518601),
    float3(0.0193066305447665,0.96414625633196,0.0165471134285413),
    float3(0.031289649321998,0.951109697178212,0.0176006555471729),
    float3(0.0668370590231314,0.914977989973778,0.0181849523033105),
    float3(0.47055821975157,0.511444995583411,0.0179967968958568),
    float3(0.910322527198126,0.0726668485313894,0.0170106249605477),
    float3(0.948080455313271,0.0361923080770627,0.0157272385852104),
    float3(0.961821356060462,0.0237477481751048,0.0144308959859631),
    float3(0.969199115942889,0.0175698872533994,0.0132309972432555),
    float3(0.973908662984669,0.0139226460381375,0.0121686912671749),
    float3(0.977209973244265,0.0115405563250229,0.0112494709794463),
    float3(0.979656739520468,0.00987936539339772,0.0104638955435151),
    float3(0.981533157171168,0.00866834659880336,0.00979849656878104),
    float3(0.98300459261219,0.00775698136505557,0.00923842640607187),
    float3(0.984186034298509,0.0070497600039875,0.00876420604257239),
    float3(0.985154144725996,0.00648659344310688,0.00835926216828412),
    float3(0.985960394124136,0.00602876059685385,0.00801084569654375),
    float3(0.986640780839053,0.00565019506385772,0.00770902447378607),
    float3(0.987219960775549,0.00533339573118596,0.00744664385732223),
    float3(0.987712462684063,0.00506760323360109,0.00721993441762183),
    float3(0.98812922337855,0.00484481984619499,0.00702595719156639),
    float3(0.988479466505093,0.00465858261733583,0.00686195128437309),
    float3(0.988771011112271,0.00450363052254957,0.00672535880950215),
    float3(0.989010580213688,0.00437559807374124,0.00661382217947227),
    float3(0.9892042685635,0.00427064636886897,0.00652508545411795),
    float3(0.989267381249336,0.00421399837222459,0.0065186207014573),
    float3(0.98926740534975,0.0041821610608368,0.00655043395806412),
    float3(0.989234375147028,0.00415983508196995,0.00660579020001557),
    float3(0.988677031131798,0.00429505524467431,0.00702791405273997),
    float3(0.989261896340495,0.00411521650646233,0.00662288754111876),
    float3(0.989216667360449,0.00410703662046563,0.00667629645389074),
    float3(0.98908381615834,0.00413798119759596,0.00677820303410443),
    float3(0.989159735413925,0.00410561424141076,0.00673465078490153),
    float3(0.989149438069669,0.00410210406035243,0.00674845823809849),
    float3(0.989267414017139,0.00407205376923983,0.00666053260312171),
    float3(0.989267347297893,0.00406867675841742,0.0066639763143222),
    float3(0.989149465414196,0.00410374302842169,0.00674679197440041),
    float3(0.989010741739061,0.00414689990776415,0.00684235874466237),
    float3(0.988851556765261,0.00419805577549299,0.00695038786462158),
    float3(0.988666611701783,0.0042592412800962,0.00707414740744478),
    float3(0.988449830921947,0.00433277711218761,0.00721739228664503),
    float3(0.988195045723736,0.00442099331156629,0.00738396127962477),
    float3(0.987895790071809,0.00452631586678535,0.00757789432283689),
    float3(0.987547682812115,0.00465035300600109,0.00780196443975241),
    float3(0.987156395994108,0.00479084335761819,0.00805276096208005),
    float3(0.986730687865098,0.00494437506976931,0.00832493739352415),
    float3(0.986280206086251,0.0051072340743429,0.00861256011031588),
    float3(0.985815725823163,0.00527530812606157,0.00890896633417709),
    float3(0.985346439308458,0.00544510677638383,0.00920845415055283),
    float3(0.984870899926437,0.00561716707756873,0.00951193322145867),
    float3(0.984384353309599,0.0057932674062179,0.00982237946648336),
    float3(0.983881364727288,0.00597543537475818,0.0101432000722108),
    float3(0.983355832537928,0.00616594246133098,0.0104782251474164),
    float3(0.982801681826561,0.00636703393642332,0.0108312843643075),
    float3(0.982214944276448,0.0065801254183601,0.0112049304064262),
    float3(0.981591725416592,0.00680659697277952,0.0116016776831345),
    float3(0.98092754126865,0.00704804585665008,0.0120244129683026),
    float3(0.980217090262774,0.00730637615403068,0.0124765336152861),
    float3(0.979453267798003,0.00758420524152908,0.0129625269257405),
    float3(0.978624519621515,0.0078859723879099,0.0134895079454178),
    float3(0.977717527383843,0.00821680986648768,0.01406566272648),
    float3(0.976717975770224,0.00858221875205089,0.0146998053590432),
    float3(0.975610130314012,0.00898824321526453,0.0154016262328342),
    float3(0.974380955661223,0.00943989050166923,0.016179153503124),
    float3(0.97303407501227,0.00993577225357135,0.0170301523769722),
    float3(0.971579295046055,0.0104721558632539,0.0179485487499031),
    float3(0.970029137485527,0.0110442972001875,0.0189265649081134),
    float3(0.968399706730058,0.0116460953881084,0.0199541973030008),
    float3(0.966705025849687,0.0122722369902735,0.021022736604104),
    float3(0.964937629361706,0.0129255280066701,0.0221368420177389),
    float3(0.963082130442705,0.0136117759302372,0.0233060928289402),
    float3(0.961120546417721,0.0143377754175333,0.0245416773622041),
    float3(0.9590319139876,0.0151114621734259,0.0258566227866761),
    float3(0.956796175514438,0.0159404740186431,0.027263349512981),
    float3(0.954407851284952,0.016827045662572,0.0287651018742996),
    float3(0.951866676073972,0.0177714865078491,0.0303618362319376),
    float3(0.949173892094391,0.0187735660724978,0.0320525403474783),
    float3(0.946332511974346,0.0198324130524218,0.0338350735352774),
    float3(0.943345001728747,0.0209473786587602,0.0357076179263381),
    float3(0.940203648515703,0.0221216857161372,0.0376746637708886),
    float3(0.936897409987339,0.0233598532330812,0.0397427346744222),
    float3(0.933414159950306,0.0246668596885005,0.0419189783494429),
    float3(0.929740524243158,0.0260482124393599,0.0442112610380524),
    float3(0.925855987461467,0.027512146274089,0.0466318636851517),
    float3(0.921711471921493,0.0290777114165444,0.0492108139101391),
    float3(0.917243538045007,0.0307695668950082,0.0519868921571845),
    float3(0.912378106804082,0.032616739271856,0.0550051506612125),
    float3(0.907028952197872,0.0346533860677326,0.0583176583842104),
    float3(0.901115003869107,0.0369124928322675,0.061972499429983),
    float3(0.894627709019822,0.0394004375408431,0.0659718493328085),
    float3(0.887588778616097,0.0421129926205522,0.0702982242094708),
    float3(0.880035520058126,0.045040602520688,0.0749238723495664),
    float3(0.872022572079822,0.0481669710569523,0.0798104513613239),
    float3(0.863596414980893,0.0514780312477339,0.0849255479810375),
    float3(0.854704135853001,0.0549973448052305,0.0902985129470983),
    float3(0.845263865037901,0.0587615126664724,0.0959746151561844),
    float3(0.835164234228834,0.0628159425352819,0.102019815549722),
    float3(0.824272187898797,0.0672139629653747,0.108513841066305),
    float3(0.81243615811694,0.0720139577867945,0.115549875361241),
    float3(0.799554520195097,0.077255705344938,0.1231897643896),
    float3(0.785585551400888,0.0829687581926738,0.131445679085806),
    float3(0.77059797235583,0.0891658605651413,0.140236154887926),
    float3(0.754760688368665,0.0958388811531214,0.149400416994105),
    float3(0.738236975719522,0.102963396129037,0.158799613480885),
    float3(0.721183518780123,0.110470201598867,0.168346263538835),
    float3(0.703725364167222,0.11828312573515,0.177991492572075),
    float3(0.686168541918471,0.126264025632914,0.187567413274633),
    float3(0.6691014235548,0.134160995220305,0.196737560163804),
    float3(0.653109491273661,0.141709675782503,0.205180810262307),
    float3(0.638215526478275,0.148883288878905,0.212901160346387),
    float3(0.624181645705891,0.155766976057149,0.220051352305384),
    float3(0.610690212568645,0.162488299800432,0.226821459767806),
    float3(0.597407438389556,0.169196694433434,0.233395837485818),
    float3(0.584083552723607,0.176016114608081,0.239900300561521),
    float3(0.570748939335397,0.182939507363671,0.246311519008544),
    float3(0.557518389511387,0.189919996534704,0.252561577091982),
    float3(0.544522552139376,0.196899404662466,0.258578003504021),
    float3(0.531898809916482,0.203808267712451,0.264292879711033),
    float3(0.519754395007152,0.210577676294061,0.269667882798696),
    float3(0.50774930822063,0.21713871300938,0.275111929440529),
    float3(0.49724655471009,0.223498311608695,0.279255080763256),
    float3(0.486917069519072,0.2295842389745,0.283498634632749),
    float3(0.47720566645071,0.235392602481688,0.287401670206982),
    float3(0.468109700074472,0.240926940143867,0.290963294594973),
    float3(0.459397412658735,0.246290143370965,0.294312374095256),
    float3(0.450946008343407,0.251568634559499,0.297485282122744),
    float3(0.442614488798001,0.256839992043789,0.300545438238409),
    float3(0.434311955978638,0.262161160974956,0.303526795380919),
    float3(0.426023875819186,0.267542374864477,0.306433653803779),
    float3(0.417917421815236,0.27287378975905,0.309208683825244),
    float3(0.410169845563115,0.278031834508319,0.31179820459365),
    float3(0.402850283906071,0.282970590100404,0.314178998856179),
    float3(0.396077350690941,0.287593834369213,0.316328674249106),
    float3(0.389957444122094,0.291811256524333,0.318231143498422),
    float3(0.384417756099057,0.295673660400157,0.319908411332678),
    float3(0.37958956788575,0.299066827112916,0.321343415092933),
    float3(0.375505813949727,0.301955363715723,0.322538614543891),
    float3(0.372054455444386,0.304416721465106,0.323528597323951),
    float3(0.369258422307495,0.306422085971136,0.324319249151433),
    float3(0.366974936529127,0.308066808807225,0.324957996229284),
    float3(0.365027410765379,0.309475417494957,0.325496897646785),
    float3(0.363270582875766,0.310752243609656,0.325976883780891),
    float3(0.361611551321096,0.311963649081228,0.32642449345612),
    float3(0.360006491185019,0.313140149590384,0.326853035168552),
    float3(0.358455027259584,0.314281405449835,0.327263223798044),
    float3(0.356957753201009,0.315386941585728,0.327654940204382),
    float3(0.355516113074104,0.316455309958497,0.328028188565432),
    float3(0.354131597457431,0.317485010349718,0.328382978629746),
    float3(0.352812618332759,0.318468978632809,0.328717961510659),
    float3(0.351570767660263,0.319398012508374,0.329030748002959),
    float3(0.350406978974473,0.320271228184325,0.329321288886345),
    float3(0.349323662444366,0.321086111685236,0.329589688055097),
    float3(0.3483254723968,0.321838652231916,0.329835302322305),
    float3(0.347409953666681,0.322530302812563,0.330059133618807),
    float3(0.346551839316617,0.323179779309591,0.330267732556819),
    float3(0.345725463931662,0.323806292905732,0.330467551681723),
    float3(0.344911242176026,0.324424632544639,0.330663385721125),
    float3(0.344094923178749,0.325045635561157,0.330858646184776),
    float3(0.343272617544637,0.325672286215913,0.331054235605566),
    float3(0.34246463381076,0.326289100289123,0.331245329679247),
    float3(0.341691657933856,0.326880178250347,0.331427141747785),
    float3(0.340978992446758,0.327423294574038,0.331596594724302),
    float3(0.340308546669854,0.327940178493338,0.331750050921398),
    float3(0.339714434145185,0.328396403734122,0.331887825172607),
    float3(0.339178020313029,0.328808778307809,0.332011741956555),
    float3(0.338688989226496,0.329185095822886,0.332124322764153),
    float3(0.338238793819259,0.32953183146608,0.332227636907457),
    float3(0.337820387223979,0.329854341379531,0.332323372176796),
    float3(0.337428358803245,0.33015673938345,0.33241282155364),
    float3(0.337059593960997,0.330441382144034,0.332496738385965),
    float3(0.336711799297235,0.330710003016331,0.332575677698766),
    float3(0.336393489134285,0.330953530738308,0.33265018939778),
    float3(0.336071726615592,0.331204759553083,0.332720407186174),
    float3(0.335778961551176,0.331431209900532,0.332786351701114),
    float3(0.335514753467587,0.331635640205613,0.332845710523242),
    float3(0.335288428531529,0.331810798234289,0.332896429223342),
    float3(0.335106400805813,0.331951691503971,0.332937121502569),
    float3(0.334982830237101,0.332045015184259,0.332966982226614),
    float3(0.33488622718803,0.33212213939852,0.332986177196332),
    float3(0.334833532894243,0.332162955473576,0.332997867533508),
    float3(0.334800885693187,0.332188262946562,0.333005085140322),
    float3(0.334777409959641,0.332206475043291,0.333010258369814),
    float3(0.334754648816851,0.332224131172513,0.333015272788072),
    float3(0.334726747562834,0.3322457566078,0.3330214331626),
    float3(0.334691498889229,0.332273056920239,0.333029228124995),
    float3(0.334647849086408,0.332306842183399,0.333038890806484),
    float3(0.334595164551481,0.332347598898901,0.333050556332937),
    float3(0.334533170699357,0.332395532233052,0.333064278543963),
    float3(0.334462673481989,0.332450009776818,0.333079868893349),
    float3(0.334387428202622,0.332508119588588,0.333096484008189),
    float3(0.334321057590764,0.332557055569046,0.333113311257929),
    float3(0.334236779489025,0.332624321950136,0.333129634721204),
    float3(0.334176374645139,0.332668565221611,0.333145037096858),
    float3(0.334102053304267,0.332728017392087,0.33315909121194),
    float3(0.334044269237699,0.332772397765162,0.333171643842437),
    float3(0.334003485294713,0.332811116613815,0.333172848857627),
    float3(0.333960612549575,0.332834225679941,0.33319177783655),
    float3(0.333915928070901,0.332870662692583,0.333199256746151)
};

// 300nm - 780nm, steps of 5nm
static const float d65_rad[] = {
    0.0341,
    1.6643,
    3.2945,
    11.7652,
    20.236,
    28.6447,
    37.0535,
    38.5011,
    39.9488,
    42.4302,
    44.9117,
    45.775,
    46.6383,
    49.3637,
    52.0891,
    51.0323,
    49.9755,
    52.3118,
    54.6482,
    68.7015,
    82.7549,
    87.1204,
    91.486,
    92.4589,
    93.4318,
    90.057,
    86.6823,
    95.7736,
    104.865,
    110.936,
    117.008,
    117.41,
    117.812,
    116.336,
    114.861,
    115.392,
    115.923,
    112.367,
    108.811,
    109.082,
    109.354,
    108.578,
    107.802,
    106.296,
    104.79,
    106.239,
    107.689,
    106.047,
    104.405,
    104.225,
    104.046,
    102.023,
    100,
    98.1671,
    96.3342,
    96.0611,
    95.788,
    92.2368,
    88.6856,
    89.3459,
    90.0062,
    89.8026,
    89.5991,
    88.6489,
    87.6987,
    85.4936,
    83.2886,
    83.4939,
    83.6992,
    81.863,
    80.0268,
    80.1207,
    80.2146,
    81.2462,
    82.2778,
    80.281,
    78.2842,
    74.0027,
    69.7213,
    70.6652,
    71.6091,
    72.979,
    74.349,
    67.9765,
    61.604,
    65.7448,
    69.8856,
    72.4863,
    75.087,
    69.3398,
    63.5927,
    55.0054,
    46.4182,
    56.6118,
    66.8054,
    65.0941,
    63.3828
};

static float lookupD65Rad(uint lambda)
{
    print("lambda", lambda);

    uint rem = lambda % 5;
    if (rem == 0)
    {
        float res = d65_rad[(lambda - 300) / 5];
        print("res", res);
        return res;
    }

    uint lower = lambda - rem;
    uint upper = lambda + (5 - rem);

    float res = lerp(d65_rad[(lower - 300) / 5], d65_rad[(upper - 300) / 5], (float)rem / 5.0);
    print("res", res);
    return res;
}